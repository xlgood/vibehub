// 1. 连接设置
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// 2. 数据模型定义

// 用户表
model User {
  id            String    @id @default(cuid()) // 唯一ID
  email         String    @unique
  username      String    // 显示名
  handle        String    @unique // @handle
  avatar        String?   // 头像URL
  bio           String?
  createdAt     DateTime  @default(now())
  
  // 游戏数据
  points        Int       @default(100)
  vibeScore     Int       @default(0)
  faction       String    @default("neutral") // fire, ice, neutral
  
  // 关联
  vibes         Vibe[]    // 他发过的卡片
  votes         Vote[]    // 他投过的票
}

// Vibe 卡片表
model Vibe {
  id            String    @id @default(cuid())
  title         String
  content       String
  image         String
  visibility    String    @default("public") // public, private
  createdAt     DateTime  @default(now())
  
  // 作者
  authorId      String
  author        User      @relation(fields: [authorId], references: [id])
  
  // 投票数据 (为了性能，我们把计数存在这里，但也存详细记录)
  boostCount    Int       @default(0)
  chillCount    Int       @default(0)
  
  // 关联
  votes         Vote[]
}

// 投票记录表 (防止重复刷票)
model Vote {
  id        String   @id @default(cuid())
  type      String   // boost, chill
  
  userId    String
  vibeId    String
  
  user      User     @relation(fields: [userId], references: [id])
  vibe      Vibe     @relation(fields: [vibeId], references: [id])

  // 确保一个用户对一个卡片只能投一票
  @@unique([userId, vibeId])
}